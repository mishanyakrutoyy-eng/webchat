<!DOCTYPE html>
<html>
<head>
    <title>WEBGOBLINS</title>
    <style>
        body {
            background: #0a0f0a;
            font-family: 'Courier New';
            color: #8bc34a;
            margin: 0;
            padding: 20px;
        }
        #auth, #chat {
            max-width: 500px;
            margin: 0 auto;
            background: #0f150f;
            border: 2px solid #2f542f;
            padding: 30px;
            border-radius: 10px;
        }
        #chat {
            display: none;
        }
        input, button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #1a261a;
            border: 2px solid #2f542f;
            color: #b0f0b0;
            font-family: 'Courier New';
            font-size: 16px;
            border-radius: 5px;
        }
        button {
            background: #2f6f2f;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #3f8f3f;
        }
        #messages {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #2f542f;
            padding: 10px;
            margin: 20px 0;
        }
        .msg {
            margin: 10px 0;
            padding: 5px;
        }
        .own {
            text-align: right;
        }
        .time {
            color: #6f9e6f;
            font-size: 12px;
        }
        .user {
            color: #8bc34a;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="auth">
        <h1>WEBGOBLINS</h1>
        <input type="text" id="login" placeholder="Логин">
        <input type="password" id="pass" placeholder="Пароль">
        <button onclick="loginFunc()">Войти</button>
        <button onclick="registerFunc()">Регистрация</button>
        <div id="status" style="color: #ff6f6f;"></div>
    </div>

    <div id="chat">
        <div style="display: flex; justify-content: space-between;">
            <span id="currentUser"></span>
            <button onclick="logoutFunc()">Выйти</button>
        </div>
        <div id="messages"></div>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="msg" placeholder="Сообщение..." style="flex: 1;">
            <button onclick="sendFunc()" style="width: auto; padding: 15px 30px;">></button>
        </div>
    </div>

    <script>
        // База данных в памяти
        let users = JSON.parse(localStorage.getItem('users')) || {};
        let messages = JSON.parse(localStorage.getItem('messages')) || [];
        let currentUser = null;

        function showStatus(text, isError) {
            let status = document.getElementById('status');
            status.textContent = text;
            status.style.color = isError ? '#ff6f6f' : '#8bc34a';
            setTimeout(() => status.textContent = '', 3000);
        }

        function getTime() {
            let d = new Date();
            return d.getHours() + ':' + (d.getMinutes() < 10 ? '0' : '') + d.getMinutes();
        }

        function showMessages() {
            let div = document.getElementById('messages');
            div.innerHTML = '';
            if (messages.length === 0) {
                div.innerHTML = '<div style="text-align: center; color: #6f9e6f;">> ДОБРО ПОЖАЛОВАТЬ В КЛАН <</div>';
            } else {
                for (let i = 0; i < messages.length; i++) {
                    let m = messages[i];
                    let className = m.user === currentUser ? 'msg own' : 'msg';
                    div.innerHTML += '<div class="' + className + '">' +
                        '<span class="user">@' + m.user + '</span> ' +
                        '<span class="time">' + m.time + '</span><br>' +
                        '<span>' + m.text + '</span></div>';
                }
            }
            div.scrollTop = div.scrollHeight;
        }

        // Вход
        window.loginFunc = function() {
            let login = document.getElementById('login').value.trim();
            let pass = document.getElementById('pass').value.trim();
            
            if (!login || !pass) {
                showStatus('Заполните все поля', true);
                return;
            }
            
            if (users[login] && users[login] === pass) {
                currentUser = login;
                document.getElementById('currentUser').textContent = '@' + login;
                document.getElementById('auth').style.display = 'none';
                document.getElementById('chat').style.display = 'block';
                showMessages();
                document.getElementById('login').value = '';
                document.getElementById('pass').value = '';
            } else {
                showStatus('Неверный логин или пароль', true);
            }
        };

        // Регистрация
        window.registerFunc = function() {
            let login = document.getElementById('login').value.trim();
            let pass = document.getElementById('pass').value.trim();
            
            if (!login || !pass) {
                showStatus('Заполните все поля', true);
                return;
            }
            
            if (pass.length < 3) {
                showStatus('Пароль слишком короткий', true);
                return;
            }
            
            if (users[login]) {
                showStatus('Пользователь уже существует', true);
                return;
            }
            
            users[login] = pass;
            localStorage.setItem('users', JSON.stringify(users));
            showStatus('Регистрация успешна', false);
            document.getElementById('login').value = login;
            document.getElementById('pass').value = '';
        };

        // Выход
        window.logoutFunc = function() {
            if (currentUser) {
                currentUser = null;
                document.getElementById('auth').style.display = 'block';
                document.getElementById('chat').style.display = 'none';
            }
        };

        // Отправка
        window.sendFunc = function() {
            let text = document.getElementById('msg').value.trim();
            if (!text || !currentUser) return;
            
            messages.push({
                user: currentUser,
                text: text,
                time: getTime()
            });
            localStorage.setItem('messages', JSON.stringify(messages));
            showMessages();
            document.getElementById('msg').value = '';
        };

        // Enter
        document.getElementById('msg').onkeypress = function(e) {
            if (e.key === 'Enter') sendFunc();
        };
        document.getElementById('pass').onkeypress = function(e) {
            if (e.key === 'Enter') loginFunc();
        };

        // Загрузка
        showMessages();
    </script>
</body>
</html>
